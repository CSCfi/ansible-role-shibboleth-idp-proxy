<?xml version="1.0" encoding="UTF-8"?>
<AttributeFilterPolicyGroup id="ShibbolethFilterPolicy"
        xmlns="urn:mace:shibboleth:2.0:afp"
        xmlns:oidcext="org.geant.idpextension.oidc.attribute.filter"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="urn:mace:shibboleth:2.0:afp http://shibboleth.net/schema/idp/shibboleth-afp.xsd
                            org.geant.idpextension.oidc.attribute.filter classpath:/schema/idp-oidc-extension-afp.xsd">
                    
  <AttributeFilterPolicy id="releaseToAnyone">

    <PolicyRequirementRule xsi:type="ANY"/>
{% for attribute in shibbolethproxy_attributes['ScriptedAttribute'] | default([]) | selectattr('filter', 'undefined') %}
    <AttributeRule attributeID="{{ attribute.id }}">
      <PermitValueRule xsi:type="ANY" />
    </AttributeRule>
{% endfor %}

{% for attribute in shibbolethproxy_attributes['myLDAP'] | default([]) | selectattr('filter', 'undefined') %}
    <AttributeRule attributeID="{{ attribute.id }}">
      <PermitValueRule xsi:type="ANY" />
    </AttributeRule>
{% endfor %}

  </AttributeFilterPolicy>
{% if 'oidc' in shibbolethidp_configurablesÂ %} 
	<AttributeFilterPolicy id="OPENID_SCOPE">
		<PolicyRequirementRule xsi:type="oidcext:OIDCScope" value="openid" />
		<AttributeRule attributeID="subject">
			<PermitValueRule xsi:type="ANY" />
		</AttributeRule>
	</AttributeFilterPolicy> 
{% endif %} 
</AttributeFilterPolicyGroup>
